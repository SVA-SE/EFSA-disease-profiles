---
title: "Evidence from systematic literature review"
params:
    styling: TRUE
    agent: "agent"
    min.groups.plot: 1
    agent.subtype: "agentSubtype"
output:
  flexdashboard::flex_dashboard:
    vertical_layout: scroll
    orientation: rows
    self_contained: false

---
<style type="text/css">

body{
  font-family: Verdana;
  font-size: 12pt;
}

.navbar {
  background-color:#1DAF8E;
}

.bggreen {
  background-color: #1DAF8E;
}

.bgorange {
  background-color: #fc5e03;
}

/* Headers */
h1{
  font-family: Verdana;
  font-size: 16pt;
  font-weight: bold; 
  color: white;
}

.chart-title {
    font-size: 16pt;
}

.nav-tabs-custom .nav-tabs li.active a {
    font-size: 16pt;
}

.nav-tabs-custom .nav-tabs li:not(.active) a {
    font-size: 16pt;
}


</style>


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message=FALSE, fig.width=10,fig.height=6)
library(tidyr)
library(wordcloud)
library(RColorBrewer)
library(wordcloud2)
library(tm)

library(plotly)
library(dplyr)
library(stringr)
library(knitr)
library(gdata)
library(kableExtra)
library(DT)
library(flexdashboard)




source("Functions.r")
#source("Metaanalysis_functions.r")

dfgd <- read.csv("../data/FilesDownload/GeoDistribution_cleaned.csv")
references <- read.csv("../data/FilesDownload/GeoDistribution_refid.csv")

agent <- params$agent 
styling <- params$styling 
min.groups.plot <- params$min.groups.plot 
agent.subtype <- params$agent.subtype

# styling=T
# min.groups.plot=1
# agent = agents[a]
# agent.subtype <- agent.subtypes[a]


dfDZ <- dfgd[dfgd$agent==agent,]


dfDZ$targetSpecies <- gsub("\\s*\\([^\\)]+\\)","",as.character(dfDZ$targetSpecies))
dfDZ <- species.name.cleanup(data=dfDZ)

references$targetSpecies<- gsub("\\s*\\([^\\)]+\\)","",as.character(references$targetSpecies))
references <- species.name.cleanup(data=references)


dfDZ$targetSpecies <- as.factor(dfDZ$targetSpecies)

plots.font <- list(
  family="Verdana",
  size=16
)

unique.sp <- as.character(unique(dfDZ$targetSpecies))
unique.sp <- unique.sp[-which(unique.sp=="not investigated/not given/not relevant")]

#table(dfDZ$targetSpecies)
```


Row
-----------------------------------------------------------------------


###  {.bggreen data-width=150}
<h1>Host species</h1>


###

Disease was demonstrated in the following animal species:

<b>  `r trimws(sort(unique.sp),which="right")`</b>



Row
-----------------------------------------------------------------------
###  {.bgorange}

<h1>WORK IN PROGRESS!</h1>
This section of the disease profiles in currently under construction, we will keep updating and improving this under the remainder of 2022.  




Row
-----------------------------------------------------------------------

###  {.bggreen data-width=150}

<h1>Most frequent clinical signs</h1>




### 



```{r clinicalsigns.plot, message=FALSE, warning=FALSE, results='asis'}
#Do it per species


text <- dfDZ %>%
    select(clinicalSigns) %>%
    mutate_all(na_if,"") %>%
    na.omit()


# Create a corpus
docs <- Corpus(VectorSource(text))



docs <- docs %>%
    tm_map(removeNumbers) %>%
    tm_map(removePunctuation) %>%
    tm_map(stripWhitespace)
docs <- tm_map(docs, content_transformer(tolower))
docs <- tm_map(docs, removeWords, stopwords("english"))

dtm <- TermDocumentMatrix(docs)
matrix <- as.matrix(dtm)
words <- sort(rowSums(matrix),decreasing=TRUE)
df <- data.frame(word = names(words),freq=words)



 df$word <- as.factor(df$word)
 wordcloud2(df[(df$freq>3),], size=0.5,minSize=0.4)




```



Row{data-height=60 .bggreen}
-----------------------------------------------------------------------


<h1> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REFERENCES </h1>


Row
-----------------------------------------------------------------------
###
In the left panel you can find information about the entire systematic literature review. The specific references for this agent, and used in this section of the story map are listed below.

Row{data-height=600}
-----------------------------------------------------------------------

```{r}
options(DT.options = list(scrollY="100vh",pageLength =5))
datatable(unique(references[references$Refid%in%dfDZ$refID,c(1,3,6)]), filter = 'top', rownames=FALSE)

```
 


